= Тестовая стратегия проекта

Этот документ описывает стратегию тестирования для iOS-приложения "SDET Demo App", основанную на принципах пирамиды тестирования. Стратегия определяет различные уровни тестов, их цели, инструменты и области применения в проекте.

image::https://martinfowler.com/bliki/images/testPyramid/test-pyramid.png[Test Pyramid, 400]

Разработка тестов будет вестись последовательно, снизу вверх по пирамиде.

== 1. Unit-тесты (Основание пирамиды)

*Цель:* Проверка наименьших изолированных компонентов системы (функций, методов, классов) на корректность работы. Эти тесты проверяют бизнес-логику, вычисления и алгоритмы в отрыве от UI и внешних зависимостей.

*Что тестируем:*
- *Логика корзины (`MyCartViewController`):* Расчет общей стоимости, добавление/удаление/изменение количества товаров.
- *Логика добавления товара (`ProductPageDetailViewController`):* Проверка сценариев добавления нового или уже существующего товара.
- *Логика сортировки (`CatalogViewController`):* Корректность сортировки товаров по имени и цене.
- *Логика валидации (`LoginViewController`, `ShippingAddressViewController`):* Проверка полей ввода на заполненность и корректность формата.
- *Вспомогательная логика:* Обработка URL (`WebViewViewController`), логика "кулдауна" сканера (`QRCodeScannerViewController`).

*Инструменты:*
- `XCTest`

*Характеристики:*
- Самые быстрые и стабильные тесты.
- Дешевые в написании и поддержке.
- Составляют наибольшую часть всех тестов.

== 2. UI Module-тесты (Модульные UI-тесты)

*Цель:* Проверка одного экрана (`UIViewController`) или сложного UI-компонента в изоляции. Тестируется взаимодействие пользователя с UI элементами и корректность обновления UI в ответ на изменение состояния (например, из `ViewModel`).

*Что тестируем:*
- *`LoginViewController`:* При нажатии на кнопку "Login" с валидными данными происходит переход на следующий экран (проверяем вызов навигации). При невалидных данных — показывается алерт (мокаем `UIAlertController`).
- *`MyCartViewController`:* При нажатии на `+`/`-` обновляется ячейка таблицы и итоговая сумма. При удалении всех товаров отображается экран "пустой корзины".
- *`CatalogViewController`:* При нажатии на кнопку сортировки `UICollectionView` перезагружается с отсортированными данными.

*Инструменты:*
- `XCTest`
- Моки для `UINavigationController`, `UIAlertController` и других системных зависимостей.

*Характеристики:*
- Быстрее, чем полные UI-тесты, так как не требуют запуска всего приложения.
- Проверяют связку "UI <-> Логика" в рамках одного модуля.

== 3. Snapshot-тесты (Снапшот-тесты)

*Цель:* Защита от непреднамеренных визуальных изменений (регрессий). Тест делает "снимок" UI-компонента или экрана и сравнивает его с эталонным изображением.

*Что тестируем:*
- Отдельные `UIView` компоненты: ячейки таблиц (`ProductCell`), кастомные кнопки, карточки товаров (`ProductsCell`).
- Экраны в разных состояниях: `MyCartViewController` (пустой, с товарами), `LoginViewController` (с ошибкой, без ошибки).
- Различные размеры устройств и темы (светлая/темная).

*Инструменты:*
- `XCTest`
- Библиотека для снапшот-тестирования (например, `SnapshotTesting` от Point-Free).

*Характеристики:*
- Очень быстрые, так как не требуют взаимодействия с UI.
- Эффективно ловят визуальные баги, которые сложно отследить другими видами тестов.

== 4. UI Integration-тесты (Интеграционные UI-тесты)

*Цель:* Проверка взаимодействия между несколькими экранами и компонентами системы. Эти тесты имитируют короткие пользовательские сценарии.

*Что тестируем:*
- *Сценарий "Добавление товара в корзину":*
  1. Открыть экран каталога.
  2. Нажать на товар.
  3. На экране деталей товара нажать "Добавить в корзину".
  4. Перейти в корзину и убедиться, что товар добавлен.
- *Сценарий "Логин в процессе оформления заказа":*
  1. Добавить товар в корзину.
  2. Начать оформление заказа (`Proceed to Checkout`).
  3. На экране логина ввести данные.
  4. Убедиться, что произошел переход на экран адреса доставки.

*Инструменты:*
- `XCUITest`

*Характеристики:*
- Медленнее, чем unit- и snapshot-тесты.
- Более хрупкие, так как зависят от нескольких частей системы.
- Их должно быть меньше, чем тестов на нижних уровнях пирамиды.

== 5. UI System-тесты (Сквозные E2E-тесты)

*Цель:* Проверка полных, сквозных пользовательских сценариев (End-to-End), максимально приближенных к реальному использованию приложения.

*Что тестируем:*
- *Полный сценарий покупки:* От логина -> выбора товара -> добавления в корзину -> ввода адреса и платежных данных -> до экрана подтверждения заказа.
- *Сценарий сброса состояния приложения:* Залогиниться, добавить товары, затем в меню нажать "Reset App State" и убедиться, что корзина пуста, а пользователь разлогинен.

*Инструменты:*
- `XCUITest`

*Характеристики:*
- Самые медленные и хрупкие тесты.
- Дорогие в поддержке.
- Их должно быть минимальное количество, они покрывают только самые критичные для бизнеса сценарии.