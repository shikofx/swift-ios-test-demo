= Урок 1: Статический анализ кода в Swift
:sectnums:
:source-highlighter: highlight.js

== Цели урока

* Понять, что такое статический анализ и зачем он нужен.
* Изучить базовые принципы работы статических анализаторов (AST, CFG).

---

== Теория

=== Что такое статический анализ?

*Статический анализ кода* — это процесс проверки исходного кода программы без её фактического выполнения (в отличие от динамического анализа, который происходит во время работы приложения). Анализаторы "читают" ваш код и ищут в нём потенциальные проблемы, ошибки, уязвимости и несоответствия стилю кодирования.

Это как если бы очень педантичный и опытный программист просматривал ваш код и давал свои замечания ещё до того, как вы попытаетесь его скомпилировать и запустить.

=== Зачем нужен статический анализ?

1.  **Раннее обнаружение ошибок:** Находит баги, которые могут быть не видны при обычном тестировании, например, утечки памяти, "мертвый" код (который никогда не выполнится), или потенциальное разыменование `nil`.
2.  **Соблюдение единого стиля кода (Code Style):** В командной работе критически важно, чтобы все писали код в одном стиле. Статический анализ автоматически следит за соблюдением правил форматирования, именования и т.д.
3.  **Повышение читаемости и поддерживаемости:** Код, написанный по общим правилам, легче читать и понимать другим разработчикам (и вам самим через полгода).
4.  **Автоматизация ревью:** Снимает с код-ревьюера рутинную задачу по вылавливанию опечаток и проблем со стилем, позволяя ему сконцентрироваться на логике и архитектуре.

=== Как работают анализаторы?

Хотя это сложная тема, базовый принцип работы большинства статических анализаторов можно разбить на несколько шагов:

1.  **Парсинг (Parsing):** Анализатор читает ваш исходный код и преобразует его в структуру данных, понятную для машины. Чаще всего это **Абстрактное синтаксическое дерево (Abstract Syntax Tree, AST)**. AST представляет собой древовидную структуру кода, где каждый узел — это оператор, переменная или выражение.
2.  **Построение графов:** На основе AST строятся более сложные модели, такие как **Граф потока управления (Control Flow Graph, CFG)**. Этот граф показывает все возможные пути выполнения вашей программы.
3.  **Анализ потока данных (Data Flow Analysis):** Анализатор "проходит" по графу потока управления и отслеживает состояние переменных. Например, он может определить, была ли переменная инициализирована перед использованием или может ли она быть `nil` в определенной точке.
4.  **Применение правил:** Наконец, анализатор применяет к построенным моделям свой набор правил.
    *   **Линтеры (как SwiftLint)** в основном работают с AST, проверяя структуру кода на соответствие правилам стиля (например, "длина строки не более 120 символов" или "имя константы должно быть в `camelCase`").
    *   **Более мощные анализаторы (как Clang Analyzer)** используют CFG и анализ потока данных для поиска сложных логических ошибок (например, "эта переменная может быть `nil`, и здесь происходит ее принудительное разыменование, что приведет к крешу").

Понимание этих шагов помогает осознать, почему анализаторы могут находить одни ошибки, но пропускать другие, и почему некоторые правила (особенно в Clang) могут казаться "магическими".

=== Что дальше?

Теперь, когда мы разобрались с общей теорией, в следующем уроке мы подробно рассмотрим ключевые инструменты статического анализа для Swift.