= Урок 5: Кэширование зависимостей
:sectnums:
:source-highlighter: highlight.js

== Цели урока

* Понять, зачем нужно кэширование в CI/CD.
* Научиться кэшировать зависимости CocoaPods для ускорения пайплайна.

---

== Теория

=== Зачем нужно кэширование?

Каждый раз, когда запускается задача в CI, она выполняется на чистой виртуальной машине. Это значит, что все зависимости (например, CocoaPods) нужно скачивать и устанавливать заново. Этот процесс может занимать несколько минут и замедлять получение обратной связи.

*Кэширование* позволяет сохранить файлы и директории (например, папку `Pods/`) между запусками workflow. Если зависимости не изменились, пайплайн может просто восстановить их из кэша, пропустив долгий этап установки.

=== Кэширование CocoaPods

Для кэширования используется официальный action `actions/cache`. Давайте добавим его в нашу задачу `clang_analysis` перед шагом установки зависимостей.

[source,yaml]
----
# В задаче clang_analysis
- name: Cache CocoaPods dependencies
  uses: actions/cache@v4
  with:
    path: Pods
    key: ${{ runner.os }}-pods-${{ hashFiles('**/Podfile.lock') }}
    restore-keys: |
      ${{ runner.os }}-pods-
----

*   `path: Pods`: Указываем, что мы хотим закэшировать директорию `Pods`.
*   `key: ${{ runner.os }}-pods-${{ hashFiles('**/Podfile.lock') }}`: Это уникальный ключ для нашего кэша. Он состоит из типа операционной системы и хэша файла `Podfile.lock`. Если `Podfile.lock` изменится (т.е. изменятся зависимости), хэш тоже изменится, и будет создан новый кэш.
*   `restore-keys`: Если точного совпадения по `key` не найдено, action попытается найти кэш с похожим ключом (например, для той же ОС).

Теперь шаг `pod install` будет выполняться почти мгновенно, если зависимости в `Podfile.lock` не менялись.